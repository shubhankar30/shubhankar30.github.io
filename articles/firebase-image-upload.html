<!DOCTYPE HTML>
<!--
	Prologue by HTML5 UP
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Shubhankar30</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="../assets/css/main.css" />
</head>

<body>

	<!-- Header -->
	<div id="header">

		<div class="top">

			<!-- Logo -->
			<div id="logo">
				<h1 id="title">Shubhankar Ranade</h1>
				<p>Software Engineer</p>
			</div>

			<!-- Nav -->
			<nav id="nav">
				<ul>
					<li><a href="../index.html" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Intro</span></a></li>
					<li><a href="../index.html" id="projects-link" class="skel-layers-ignoreHref"><span class="icon fa-th">Projects</span></a></li>
					<li><a href="../index.html" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user">Portfolio</span></a></li>
					<li><a href="../index.html" id="articles-link" class="skel-layers-ignoreHref"><span class="icon fa-newspaper-o">Articles</span></a></li>
					<li><a href="../index.html" id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Contact</span></a></li>
				</ul>
			</nav>
		</div>

		<div class="bottom">
			<!-- Social Icons -->
			<ul class="icons">
				<li><a href="https://www.facebook.com/30shubhankar" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
				<li><a href="https://github.com/shubhankar30" class="icon fa-github"><span class="label">Github</span></a></li>
				<li><a href="https://gitlab.com/shubhankar30" class="icon fa-gitlab"><span class="label">Gitlab</span></a></li>
				<li><a href="https://www.linkedin.com/in/shubhankar300794/" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
				<li><a href="mailto:shubhankarranade30@gmail.com?Subject=Hello" class="icon fa-envelope"><span class="label">Email</span></a></li>
			</ul>
		</div>
	</div>

	<!-- Main -->
	<div id="main">
			<!-- Projects -->
			<section id="golang-docker-article" class="two">
				<div class="container">
					<header>
						<h2>Uploading Image to Firebase and its reference to Firestore in Android</h2>
					</header>
	
					<div class="body">
						This operation would be used to link a file to any document. (Suppose you want a picture for every document you have). <br>
						For this, you have to upload image in firebase, get its reference url and save it within the document to make it easier.
						If you have the document id before the upload operation, you can perform this task with Cloud Functions but in my case, I 
						needed to create a document after the image was uploaded which is why I couldn't use Cloud functions for this task. <br>
						<br>
						As all firebase functions are async in nature, we have to wait for each operation to finish after which we can proceed to the next one.
						<br>
						The task is simple if it is a single file to be uploaded to Firebase as everything can be done in a single flow.<br>
						But in case of multiple files, each file needs to be handled in async functions.<br>

						<pre>
							final StorageReference imageFolder = FirebaseStorage.getInstance().getReference().child("ImageFolder");<br>
							db = FirebaseFirestore.getInstance();<br>
							uploadImageCounter = 0;<br>
							randomImageName = UUID.randomUUID().toString().substring(0,5);<br>
							// check if any images are selected<br>
							if (currentImageSelected > 0) {<br>
									for (uploadProgressCount = 0; uploadProgressCount < imageList.size(); uploadProgressCount++) {<br>
											Uri individualImage = imageList.get(uploadProgressCount);<br>
											imageName = imageFolder.child(randomImageName + uploadProgressCount + individualImage.getLastPathSegment());<br>
											<br>
											imageName.putFile(individualImage).addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {<br>
													@Override<br>
													public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {<br>
															uploadImageCounter++;<br>
															imageDownloadUrlCounter = 0;<br>

															if (uploadImageCounter.equals(currentImageSelected)) {<br>
																<br>
																	// At this point all images are finished uploading<br>
																	// So, get download urls of all uploaded images<br>
																	for (int i = 0; i < imageList.size(); i++) {<br>
																			Uri individualImage = imageList.get(i);<br>
																			imageName2 = imageFolder.child(randomImageName + i + individualImage.getLastPathSegment());<br>
																			imageName2.getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {<br>
																					@Override<br>
																					public void onSuccess(Uri uri) {<br>
																							imageDownloadUrlCounter++;<br>
																							String url = valueOf(uri);<br>
																							imageUrlList.add(url);<br>
																							if (imageDownloadUrlCounter.equals(currentImageSelected)) {<br>
																									// At this point, we have download urls of all images in imageUrlList<br>
																									complaintData.put("images", imageUrlList);<br>
																									<br>
																									// Add complaint data to firestore<br>
																									db.collection("complaints")<br>
																													.add(complaintData)<br>
																													.addOnSuccessListener(new OnSuccessListener<DocumentReference>() {<br>
																															@Override<br>
																															public void onSuccess(DocumentReference documentReference) {<br>
																																	progressDialog.dismiss();<br>
																																	// Go back after adding complaint<br>
																																	if (getFragmentManager() != null) {<br>
																																			getFragmentManager().popBackStackImmediate();<br>
																																	}<br>
																															}<br>
																													})<br>
																													.addOnFailureListener(new OnFailureListener() {<br>
																															@Override<br>
																															public void onFailure(@NonNull Exception e) {<br>
																																	Log.w(TAG, "Error adding document", e);<br>
																																	progressDialog.dismiss();<br>
																																	Toast.makeText(getActivity(), "Some error occured", Toast.LENGTH_SHORT).show();<br>
																																	if (getFragmentManager() != null) {<br>
																																			getFragmentManager().popBackStackImmediate();<br>
																																	}}});<br>
																							}
																					}
																			});<br>
																	}
															}
													}
											});
									}
						</pre>
					</div>
			</div>
			</section>
		</div>

	<!-- Footer -->
	<div id="footer">
		<!-- Copyright -->
		<ul class="copyright">
			<li>&copy; Shubhankar Ranade</li>
			<li></li>
		</ul>
	</div>

	<!-- Scripts -->
	<script src="../assets/js/jquery.min.js"></script>
	<script src="../assets/js/jquery.scrolly.min.js"></script>
	<script src="../assets/js/jquery.scrollzer.min.js"></script>
	<script src="../assets/js/skel.min.js"></script>
	<script src="../assets/js/util.js"></script>
	<script src="https://unpkg.com/sweetalert2"></script>
	<script src="../assets/js/custom.js"></script>
	<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	<script src="../assets/js/main.js"></script>

</body>

</html>